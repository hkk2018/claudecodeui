---
title: "å®‰å…¨æ€§æƒæ CI/CD èªªæ˜æ–‡æª”"
description: "èªªæ˜æœ¬å°ˆæ¡ˆçš„å®‰å…¨æ€§æƒæå·¥å…·ã€åˆ†å±¤ç­–ç•¥èˆ‡è¨­è¨ˆæ±ºç­–"
last_modified: "2025-12-12 14:19"
---

# å®‰å…¨æ€§æƒæ CI/CD èªªæ˜æ–‡æª”

æœ¬æ–‡æª”èªªæ˜å°ˆæ¡ˆä¸­å®‰å…¨æ€§æƒæçš„è¨­è¨ˆç†å¿µã€å·¥å…·é¸æ“‡èˆ‡åˆ†å±¤ç­–ç•¥ã€‚

---

## è¨­è¨ˆç›®æ¨™

1. **åœ¨ PR éšæ®µæ””æˆªé«˜é¢¨éšªæ¼æ´** - é¿å…å±éšªç¨‹å¼ç¢¼é€²å…¥ main åˆ†æ”¯
2. **ä¸éåº¦é˜»æ“‹é–‹ç™¼æµç¨‹** - ä¸­ä½é¢¨éšªå•é¡Œåªè­¦å‘Šï¼Œä¸é˜»æ“‹ merge
3. **æä¾›å®Œæ•´çš„å®‰å…¨æ€§å ±å‘Š** - è®“é–‹ç™¼è€…äº†è§£æ½›åœ¨é¢¨éšªä¸¦è‡ªè¡Œæ±ºå®šè™•ç†å„ªå…ˆç´š

---

## åˆ†å±¤ç­–ç•¥

### ç‚ºä»€éº¼è¦åˆ†å±¤ï¼Ÿ

å¦‚æœæ‰€æœ‰å®‰å…¨æ€§æª¢æŸ¥éƒ½è¨­ç‚ºã€Œé˜»æ“‹ã€ï¼Œæœƒé€ æˆï¼š
- é–‹ç™¼é€Ÿåº¦å¤§å¹…ä¸‹é™ï¼ˆæ¯å€‹å°å•é¡Œéƒ½è¦å…ˆä¿®ï¼‰
- èª¤å ±ï¼ˆfalse positiveï¼‰å°è‡´ç„¡æ³• merge
- é–‹ç™¼è€…ç–²å‹ï¼Œæœ€çµ‚å¯èƒ½é¸æ“‡é—œé–‰æª¢æŸ¥

å› æ­¤æˆ‘å€‘æ¡ç”¨ **åˆ†å±¤ç­–ç•¥**ï¼šé—œéµå•é¡Œé˜»æ“‹ï¼Œå…¶ä»–å•é¡Œè­¦å‘Šã€‚

### åˆ†å±¤å®šç¾©

```
ğŸ”´ é˜»æ“‹å±¤ï¼ˆBlockingï¼‰
   - é€™äº›å•é¡Œè‹¥é€²å…¥ production æœƒé€ æˆç«‹å³çš„å®‰å…¨é¢¨éšª
   - PR å¿…é ˆä¿®å¾©å¾Œæ‰èƒ½ merge

ğŸŸ¡ è­¦å‘Šå±¤ï¼ˆWarningï¼‰
   - é€™äº›å•é¡Œæœ‰æ½›åœ¨é¢¨éšªï¼Œä½†éœ€è¦äººå·¥åˆ¤æ–·æ˜¯å¦ç‚ºçœŸæ­£å•é¡Œ
   - é¡¯ç¤ºåœ¨å ±å‘Šä¸­ï¼Œç”±é–‹ç™¼è€…æ±ºå®šæ˜¯å¦è™•ç†
```

### ç›®å‰çš„åˆ†å±¤è¨­å®š

| å±¤ç´š | æª¢æŸ¥é …ç›® | é˜»æ“‹ | åŸå›  |
|------|---------|:----:|------|
| ğŸ”´ | Secrets Detection (TruffleHog) | âœ… | API Key/å¯†ç¢¼æ´©æ¼æœƒé€ æˆç«‹å³çš„å®‰å…¨äº‹ä»¶ |
| ğŸ”´ | NPM Audit Critical | âœ… | Critical ç­‰ç´šæ¼æ´æœ‰å·²çŸ¥çš„æ”»æ“Šæ–¹å¼ |
| ğŸŸ¡ | CodeQL Analysis | âŒ | éœæ…‹åˆ†æå¯èƒ½æœ‰èª¤å ±ï¼Œéœ€äººå·¥åˆ¤æ–· |
| ğŸŸ¡ | NPM Audit Full | âŒ | ä¸­ä½é¢¨éšªæ¼æ´å¯ä»¥æ’å®šæ™‚é–“ä¿®å¾© |
| ğŸŸ¡ | ESLint Security | âŒ | ç¨‹å¼ç¢¼æ¨¡å¼æª¢æ¸¬èª¤å ±ç‡è¼ƒé«˜ |
| ğŸŸ¡ | OSV Scanner | âŒ | èˆ‡ npm audit é‡è¤‡ï¼Œä½œç‚ºè£œå……è³‡è¨Š |

---

## æƒæå·¥å…·èªªæ˜

### 1. TruffleHog - Secrets Detection

| é …ç›® | èªªæ˜ |
|------|------|
| **ç”¨é€”** | æƒæç¨‹å¼ç¢¼ä¸­æ´©æ¼çš„æ•æ„Ÿè³‡è¨Š |
| **æƒæå°è±¡** | æ•´å€‹ repoï¼ŒåŒ…å« git æ­·å² |
| **åµæ¸¬ç¯„ä¾‹** | API Keysã€AWS credentialsã€ç§é‘°ã€å¯†ç¢¼ |
| **ç‚ºä½•é˜»æ“‹** | Secrets æ´©æ¼æœƒé€ æˆç«‹å³çš„å®‰å…¨äº‹ä»¶ï¼Œå¿…é ˆåœ¨é€²å…¥ repo å‰æ””æˆª |

**å¸¸è¦‹è§¸ç™¼æƒ…å¢ƒ**ï¼š
```javascript
// âŒ æœƒè¢«åµæ¸¬ä¸¦é˜»æ“‹
const OPENAI_KEY = "sk-proj-abc123...";
const AWS_SECRET = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY";
```

**ä¿®å¾©æ–¹å¼**ï¼š
- ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼š`process.env.OPENAI_KEY`
- ä½¿ç”¨ secrets manager
- å¦‚æœå·²ç¶“ commitï¼Œéœ€è¦ rotate è©² credential

---

### 2. NPM Audit - ä¾è³´æ¼æ´æª¢æŸ¥

| é …ç›® | èªªæ˜ |
|------|------|
| **ç”¨é€”** | æª¢æŸ¥ npm ä¾è³´å¥—ä»¶çš„å·²çŸ¥æ¼æ´ |
| **æƒæå°è±¡** | `package-lock.json` |
| **è³‡æ–™ä¾†æº** | npm advisory database |

**åˆ†å±¤é‚è¼¯**ï¼š
- `npm audit --audit-level=critical` â†’ ğŸ”´ é˜»æ“‹
- `npm audit --audit-level=low` â†’ ğŸŸ¡ è­¦å‘Šï¼ˆå®Œæ•´å ±å‘Šï¼‰

**æ¼æ´ç­‰ç´šèªªæ˜**ï¼š
| ç­‰ç´š | CVSS åˆ†æ•¸ | è™•ç†æ–¹å¼ |
|------|----------|---------|
| Critical | 9.0 - 10.0 | ğŸ”´ ç«‹å³ä¿®å¾© |
| High | 7.0 - 8.9 | ğŸŸ¡ ç›¡å¿«ä¿®å¾© |
| Moderate | 4.0 - 6.9 | ğŸŸ¡ æ’å®šä¿®å¾© |
| Low | 0.1 - 3.9 | ğŸŸ¡ è©•ä¼°å¾Œæ±ºå®š |

**ä¿®å¾©æ–¹å¼**ï¼š
```bash
# è‡ªå‹•ä¿®å¾©ï¼ˆå¦‚æœæœ‰ç›¸å®¹çš„æ›´æ–°ç‰ˆæœ¬ï¼‰
npm audit fix

# æŸ¥çœ‹è©³ç´°è³‡è¨Š
npm audit

# å¼·åˆ¶æ›´æ–°ï¼ˆå¯èƒ½æœ‰ breaking changesï¼‰
npm audit fix --force
```

---

### 3. CodeQL - éœæ…‹ç¨‹å¼ç¢¼åˆ†æ

| é …ç›® | èªªæ˜ |
|------|------|
| **ç”¨é€”** | åˆ†æç¨‹å¼ç¢¼é‚è¼¯ï¼Œæ‰¾å‡ºå®‰å…¨æ¼æ´ |
| **æƒæå°è±¡** | æ‰€æœ‰ JavaScript/TypeScript ç¨‹å¼ç¢¼ |
| **æä¾›è€…** | GitHub |

**å¯åµæ¸¬çš„æ¼æ´é¡å‹**ï¼š
- SQL Injection
- Cross-Site Scripting (XSS)
- Command Injection
- Path Traversal
- Prototype Pollution
- ç­‰ç­‰...

**ç‚ºä½•åªè­¦å‘Šä¸é˜»æ“‹**ï¼š
1. **èª¤å ±ç‡**ï¼šéœæ…‹åˆ†æç„¡æ³•ç†è§£å®Œæ•´çš„åŸ·è¡Œ contextï¼Œå¯èƒ½ç”¢ç”Ÿèª¤å ±
2. **éœ€è¦äººå·¥åˆ¤æ–·**ï¼šä¾‹å¦‚ `exec()` å‘¼å«ï¼Œå¦‚æœåƒæ•¸æ˜¯å¯«æ­»çš„å°±å®‰å…¨ï¼Œä½† CodeQL å¯èƒ½é‚„æ˜¯æœƒè­¦å‘Š
3. **çµæœé¡¯ç¤ºåœ¨ Security tab**ï¼šGitHub æœƒè‡ªå‹•æ•´ç†ä¸¦è¿½è¹¤é€™äº›å•é¡Œ

**æŸ¥çœ‹çµæœ**ï¼š
- GitHub repo â†’ Security tab â†’ Code scanning alerts

---

### 4. ESLint Security Plugins

| é …ç›® | èªªæ˜ |
|------|------|
| **ç”¨é€”** | æª¢æ¸¬ä¸å®‰å…¨çš„ç¨‹å¼ç¢¼æ’°å¯«æ¨¡å¼ |
| **æƒæå°è±¡** | æ‰€æœ‰ JavaScript/TypeScript ç¨‹å¼ç¢¼ |
| **ä½¿ç”¨çš„ plugins** | `eslint-plugin-security`, `eslint-plugin-no-secrets` |

**æª¢æ¸¬è¦å‰‡èªªæ˜**ï¼š

| è¦å‰‡ | èªªæ˜ | é¢¨éšª |
|------|------|------|
| `detect-eval-with-expression` | åµæ¸¬ `eval()` ä½¿ç”¨ | ç¨‹å¼ç¢¼æ³¨å…¥ |
| `detect-child-process` | åµæ¸¬ `exec()`, `spawn()` | å‘½ä»¤æ³¨å…¥ |
| `detect-non-literal-fs-filename` | åµæ¸¬å‹•æ…‹æª”æ¡ˆè·¯å¾‘ | è·¯å¾‘éæ­· |
| `detect-unsafe-regex` | åµæ¸¬ ReDoS é¢¨éšªçš„æ­£å‰‡ | DoS æ”»æ“Š |
| `detect-object-injection` | åµæ¸¬ `obj[userInput]` | Prototype pollution |
| `no-secrets` | åµæ¸¬ç¡¬ç·¨ç¢¼çš„ secrets | è³‡è¨Šæ´©æ¼ |

**ç‚ºä½•åªè­¦å‘Šä¸é˜»æ“‹**ï¼š
- èª¤å ±ç‡é«˜ï¼ˆä¾‹å¦‚ `obj[key]` å¾ˆå¸¸è¦‹ä½†ä¸ä¸€å®šå±éšªï¼‰
- æŸäº›æ¨¡å¼åœ¨ç‰¹å®š context ä¸‹æ˜¯å®‰å…¨çš„

---

### 5. OSV-Scanner - é–‹æºæ¼æ´æƒæ

| é …ç›® | èªªæ˜ |
|------|------|
| **ç”¨é€”** | æƒæä¾è³´å¥—ä»¶çš„å·²çŸ¥æ¼æ´ |
| **æƒæå°è±¡** | `package-lock.json` |
| **æä¾›è€…** | Google |
| **è³‡æ–™ä¾†æº** | OSV databaseï¼ˆæ•´åˆå¤šå€‹æ¼æ´è³‡æ–™åº«ï¼‰|

**èˆ‡ npm audit çš„å·®ç•°**ï¼š
- OSV æ•´åˆæ›´å¤šè³‡æ–™ä¾†æºï¼ˆGitHub Advisoryã€NVDã€ç­‰ï¼‰
- å¯èƒ½ç™¼ç¾ npm audit æ²’æœ‰çš„æ¼æ´
- ä½œç‚º npm audit çš„è£œå……æª¢æŸ¥

---

## å·¥ä½œæµç¨‹èªªæ˜

### è§¸ç™¼æ™‚æ©Ÿ

```yaml
on:
  push:
    branches: [main]      # Push åˆ° main æ™‚åŸ·è¡Œ
  pull_request:
    branches: [main]      # å° main ç™¼ PR æ™‚åŸ·è¡Œ
  schedule:
    - cron: '0 9 * * 1'   # æ¯é€±ä¸€ 09:00 UTC å®šæ™‚åŸ·è¡Œ
```

### åŸ·è¡Œé †åº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸¦è¡ŒåŸ·è¡Œ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ secrets-scan  â”‚ ğŸ”´ npm-critical  â”‚ ğŸŸ¡ codeql            â”‚
â”‚ ğŸŸ¡ npm-full      â”‚ ğŸŸ¡ eslint        â”‚ ğŸŸ¡ osv-scanner       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                  ğŸ“Š security-summary
                   (ç­‰å¾…æ‰€æœ‰ job å®Œæˆ)
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æª¢æŸ¥ ğŸ”´ é˜»æ“‹å±¤æ˜¯å¦é€šé        â”‚
              â”‚ - secrets-scan failed?      â”‚
              â”‚ - npm-critical failed?      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                             â”‚
              â–¼                             â–¼
         å…¨éƒ¨é€šé                      æœ‰å¤±æ•—
         âœ… å¯ä»¥ merge                 âŒ é˜»æ“‹ merge
```

### PR é é¢é¡¯ç¤º

```
Checks:
âœ… ğŸ”´ Secrets Detection (Blocking)      â† å¿…é ˆé€šé
âœ… ğŸ”´ NPM Audit Critical (Blocking)     â† å¿…é ˆé€šé
âš ï¸ ğŸŸ¡ CodeQL Analysis (Warning)         â† å¯ä»¥æœ‰è­¦å‘Š
âš ï¸ ğŸŸ¡ NPM Audit Full (Warning)          â† å¯ä»¥æœ‰è­¦å‘Š
âš ï¸ ğŸŸ¡ ESLint Security (Warning)         â† å¯ä»¥æœ‰è­¦å‘Š
âš ï¸ ğŸŸ¡ OSV Scanner (Warning)             â† å¯ä»¥æœ‰è­¦å‘Š
âœ… ğŸ“Š Security Summary                   â† æœ€çµ‚åˆ¤å®š
```

---

## Dependabot è‡ªå‹•æ›´æ–°

é™¤äº†æƒæå¤–ï¼Œå°ˆæ¡ˆä¹Ÿå•Ÿç”¨äº† Dependabot è‡ªå‹•ä¾è³´æ›´æ–°ï¼š

| è¨­å®š | å€¼ |
|------|---|
| æª¢æŸ¥é »ç‡ | æ¯é€±ä¸€ 09:00 å°åŒ—æ™‚é–“ |
| è‡ªå‹•ç™¼ PR | âœ… æ˜¯ |
| PR æ•¸é‡é™åˆ¶ | npm: 10, actions: 5 |
| æ›´æ–°ç¯„åœ | minor å’Œ patchï¼ˆmajor éœ€æ‰‹å‹•ï¼‰|

**é‹ä½œæ–¹å¼**ï¼š
1. Dependabot åµæ¸¬åˆ°æœ‰æ–°ç‰ˆæœ¬å¯ç”¨
2. è‡ªå‹•å»ºç«‹ PR æ›´æ–°ä¾è³´
3. å®‰å…¨æƒææœƒè‡ªå‹•åœ¨ PR ä¸ŠåŸ·è¡Œ
4. é€šéå¾Œç”±ç¶­è­·è€… review ä¸¦ merge

---

## æœªä¾†æ”¹é€²æ–¹å‘

### å¯è€ƒæ…®çš„å¢å¼·

1. **æŒ‰éŒ¯èª¤åš´é‡åº¦åˆ†å±¤**
   - ç›®å‰æ˜¯æŒ‰ã€Œå·¥å…·ã€åˆ†å±¤
   - å¯æ”¹ç‚ºè§£æå„å·¥å…·è¼¸å‡ºï¼ŒæŒ‰ CVSS åˆ†æ•¸æ±ºå®šæ˜¯å¦é˜»æ“‹

2. **åŠ å…¥ SAST å·¥å…·**
   - Semgrepï¼šæ›´å¤šè‡ªè¨‚è¦å‰‡
   - Snykï¼šå•†æ¥­ç´šæƒæï¼ˆéœ€è¦ API keyï¼‰

3. **åŠ å…¥ DAST å·¥å…·**
   - å° running application é€²è¡Œæ»²é€æ¸¬è©¦

4. **åŠ å…¥ License æª¢æŸ¥**
   - ç¢ºä¿ä¾è³´å¥—ä»¶çš„ license ç›¸å®¹

### èª¿æ•´åˆ†å±¤è¨­å®š

å¦‚æœè¦èª¿æ•´å“ªäº›æª¢æŸ¥è¦é˜»æ“‹ï¼š

1. **æ”¹ç‚ºé˜»æ“‹**ï¼šç§»é™¤è©² job çš„ `continue-on-error: true`
2. **æ”¹ç‚ºè­¦å‘Š**ï¼šåŠ ä¸Š `continue-on-error: true`
3. **èª¿æ•´ npm audit ç­‰ç´š**ï¼šä¿®æ”¹ `--audit-level=` åƒæ•¸

---

## ç›¸é—œæª”æ¡ˆ

| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `.github/workflows/security.yml` | å®‰å…¨æƒæ workflow |
| `.github/dependabot.yml` | Dependabot è¨­å®š |
| `.github/SECURITY_SCANNING.md` | æœ¬æ–‡æª” |

---

## åƒè€ƒè³‡æ–™

- [GitHub CodeQL Documentation](https://docs.github.com/en/code-security/code-scanning/introduction-to-code-scanning/about-code-scanning-with-codeql)
- [npm audit Documentation](https://docs.npmjs.com/cli/v10/commands/npm-audit)
- [TruffleHog GitHub Action](https://github.com/trufflesecurity/trufflehog)
- [OSV-Scanner](https://google.github.io/osv-scanner/)
- [eslint-plugin-security](https://github.com/eslint-community/eslint-plugin-security)
- [Dependabot Documentation](https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file)
